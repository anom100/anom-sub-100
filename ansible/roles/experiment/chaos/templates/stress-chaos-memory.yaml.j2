apiVersion: chaos-mesh.org/v1alpha1
kind: StressChaos
metadata:
  name: {{ ray_service_name }}-stress-chaos-memory
  namespace: chaosmesh
spec:
  mode: {{ stress_chaos_memory_mode }}
  selector:
    namespaces:
      - {{ stress_chaos_memory_namespace | default(ray_service_namespace) | default('ray') }}
    labelSelectors:
      'model.name': {{ ray_service_name }}
      'ray.io/serve': 'true'
{% for key, value in (chaos_anomaly_injection_label_selectors | default({})).items() %}
      '{{ key }}': '{{ value }}'
{% endfor %}
    containerNames:
      - {{ chaos_anomaly_injection_target_container | default(ray_service_head_container_name) }}
  stressors:
    memory:
      workers: {{ stress_chaos_memory_stressors_workers }}
      size: "{{ stress_chaos_memory_stressors_size }}"
      time: {{ stress_chaos_memory_stressors_time | default(chaos_anomaly_injection_duration) }}s
  duration: "{{ chaos_anomaly_injection_duration }}s"